<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>minimc: Developer Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
// https://stackoverflow.com/a/68528445/5101335
MathJax.Hub.Config({
  TeX: {
    equationNumbers: {
      autoNumber: "AMS"
    }
  }
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<!-- https://jothepro.github.io/doxygen-awesome-css/md_docs_extensions.html#autotoc_md18 -->
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
</script>
<!-- https://jothepro.github.io/doxygen-awesome-css/md_docs_extensions.html#autotoc_md21 -->
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
</script>
<!-- https://jothepro.github.io/doxygen-awesome-css/md_docs_extensions.html#autotoc_md24 -->
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript">
    DoxygenAwesomeParagraphLink.init()
</script>
<!-- https://jothepro.github.io/doxygen-awesome-css/md_docs_extensions.html#autotoc_md27 -->
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript">
    DoxygenAwesomeInteractiveToc.init()
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">minimc<span id="projectnumber">&#160;0.5.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('developer_guide.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Developer Guide </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#developer_guide_intro">Introduction</a></li>
<li class="level1"><a href="#developer_guide_commenting">Commenting</a></li>
<li class="level1"><a href="#developer_guide_workflow">Workflow</a><ul><li class="level2"><a href="#developer_guide_workflow_tdd">Test Driven Development</a></li>
<li class="level2"><a href="#developer_guide_workflow_debugging">Debugging</a></li>
</ul>
</li>
<li class="level1"><a href="#developer_guide_const">Const</a></li>
<li class="level1"><a href="#developer_guide_input_parsing">Input Parsing</a><ul><li class="level2"><a href="#developer_guide_input_parsing_validation">XML Validation</a></li>
<li class="level2"><a href="#developer_guide_input_parsing_object_construction">Object Construction</a></li>
</ul>
</li>
<li class="level1"><a href="#developer_guide_variables">Variables</a><ul><li class="level2"><a href="#developer_guide_variables_passing_parameters">Passing Parameters</a></li>
<li class="level2"><a href="#developer_guide_variables_returning_values">Returning Values</a></li>
</ul>
</li>
<li class="level1"><a href="#developer_guide_smart_pointers">Smart Pointers</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="developer_guide_intro"></a>
Introduction</h1>
<p >This guide is an overview of software design principles that MiniMC developers should adhere to. C++ is intended to be an efficient language but it does not necessarily mean that it has to be complicated. The C++ standard has undergone multiple revisions over the course of decades and, as a consequence, has syntax that supports many ways of doing the same thing. Often, there exists an idiomatic approach that clearly expresses intent without compromising performance. Developers must always be aware of how their code may perform, but never to the detriment of readability. <em>Avoid premature optimization unless you can quantitatively prove its benefits via benchmarking</em>.</p>
<p >Sources for information herein come primarily from <a href="https://isocpp.org/guidelines">the C++ Core Guidelines</a>. This seems to be the definitive guide for writing "modern" C++. Occasionally, matters of opinion refer to <a href="https://stackoverflow.com">Stack Overflow</a>.</p>
<h1><a class="anchor" id="developer_guide_commenting"></a>
Commenting</h1>
<p >Generally speaking, comments should avoid explaining <em>what</em> the code is doing - that is the duty of writing "expressive" code. Rather, comments should largely be dedicated to <em>why</em>. If possible, try justifying certain code so that other developers can understand why you are implementing a feature in a particular way. Ideally, you may even cite the C++ Core Guidelines: </p><div class="fragment"><div class="line"><span class="keyword">class </span><a class="code hl_class" href="class_c_s_g_surface.html">CSGSurface</a> {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="comment">// Unique user-defined identifier (C++ Core Guidelines C.131)</span></div>
<div class="line">  <span class="keyword">const</span> std::string <a class="code hl_variable" href="class_c_s_g_surface.html#a0d02b4e9b7c8d898a8c178a1014bf480">name</a></div>
<div class="line">}</div>
<div class="ttc" id="aclass_c_s_g_surface_html"><div class="ttname"><a href="class_c_s_g_surface.html">CSGSurface</a></div><div class="ttdoc">A surface to be used in constructive solid geometry.</div><div class="ttdef"><b>Definition:</b> CSGSurface.hpp:15</div></div>
<div class="ttc" id="aclass_c_s_g_surface_html_a0d02b4e9b7c8d898a8c178a1014bf480"><div class="ttname"><a href="class_c_s_g_surface.html#a0d02b4e9b7c8d898a8c178a1014bf480">CSGSurface::name</a></div><div class="ttdeci">const std::string name</div><div class="ttdoc">Unique, user-defined identifier (C++ Core Guidelines C.131)</div><div class="ttdef"><b>Definition:</b> CSGSurface.hpp:39</div></div>
</div><!-- fragment --><p >A quick internet search of "C++ Core Guidelines C.131" will show this refers to <a href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#c131-avoid-trivial-getters-and-setters">C.131: Avoid trivial getters and setters</a>.</p>
<h1><a class="anchor" id="developer_guide_workflow"></a>
Workflow</h1>
<h2><a class="anchor" id="developer_guide_workflow_tdd"></a>
Test Driven Development</h2>
<p >Unit tests make use of the <a href="https://github.com/catchorg/Catch2">Catch2 </a> unit testing framework. It is recommended to follow a test driven development process which roughly follows</p><ol type="1">
<li>Define feature requirements in terms of a Catch2 unit test</li>
<li>Write unit test which <em>only test public interfaces</em>. Do not test private members. They should be indirectly tested by producing correct results in the public interfaces.</li>
<li>Write source code to implement the feature until the unit test works. Do not worry too much about optimization.</li>
<li>Refactor for clarity and optimizations <em>if necessary</em>.</li>
<li>Repeat.</li>
</ol>
<h2><a class="anchor" id="developer_guide_workflow_debugging"></a>
Debugging</h2>
<p >During testing, it may be useful to <a href="https://github.com/catchorg/Catch2/blob/devel/docs/command-line.md#breaking-into-the-debugger">break into a debugger</a> to examine why unit tests are failing. For lldb, this can be done by </p><div class="fragment"><div class="line">lldb all_tests --one-line &quot;break set -E c++&quot; -- --break</div>
</div><!-- fragment --><h1><a class="anchor" id="developer_guide_const"></a>
Const</h1>
<p ><a href="https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines.html#con-constants-and-immutability">Use <code>const</code> as much as possible</a>.</p>
<p >Sometimes, a <code>const</code> member variable (such as <code>const std::vector</code>) needs to be initialized using non-<code>const</code> methods (such as <code>std::vector::push_back()</code>). In such cases, one can create a static helper function which will construct a temporary object which is then used to initialize the <code>const</code> member. </p><div class="fragment"><div class="line"><span class="comment">// Note: The following code won&#39;t compile as written because of the declaration</span></div>
<div class="line"><span class="comment">// order but this will not be an issue if split into header and implemenation</span></div>
<div class="line"><span class="comment">// files.</span></div>
<div class="line"><span class="keyword">class </span><a class="code hl_class" href="class_world.html">World</a> {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <a class="code hl_class" href="class_world.html">World</a>(...): <a class="code hl_variable" href="class_world.html#ad0716d88091e7641b46ae9d5a7469167">cells</a>{CreateCells(...)} {};</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <span class="keyword">static</span> std::vector&lt;Cell&gt; CreateCells(...);</div>
<div class="line">  <span class="keyword">const</span> std::vector&lt;Cell&gt; <a class="code hl_variable" href="class_world.html#ad0716d88091e7641b46ae9d5a7469167">cells</a>;</div>
<div class="line">}</div>
<div class="ttc" id="aclass_world_html"><div class="ttname"><a href="class_world.html">World</a></div><div class="ttdoc">Represents the state of a nuclear system.</div><div class="ttdef"><b>Definition:</b> World.hpp:27</div></div>
<div class="ttc" id="aclass_world_html_ad0716d88091e7641b46ae9d5a7469167"><div class="ttname"><a href="class_world.html#ad0716d88091e7641b46ae9d5a7469167">World::cells</a></div><div class="ttdeci">const std::vector&lt; Cell &gt; cells</div><div class="ttdoc">Cells that appear in the World (C++ Core Guidelines C.131)</div><div class="ttdef"><b>Definition:</b> World.hpp:83</div></div>
</div><!-- fragment --><p> In the above code, the constructor for <code><a class="el" href="class_world.html" title="Represents the state of a nuclear system.">World</a></code> accepts parameters <code>(...)</code> which are passed onto <code>CreateCells()</code> which returns a properly-initialized temporary object. The temporary object is then used to move construct the <code>const</code> member <code>cells</code>.</p>
<p >Alternatively, one may use the <a href="https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines.html#es28-use-lambdas-for-complex-initialization-especially-of-const-variables">Immediately Invoked Function Expression (IIFE)</a> pattern to perform complex initialization of a complex <code>const</code> member (in this case <code><a class="el" href="class_world.html#ad0716d88091e7641b46ae9d5a7469167" title="Cells that appear in the World (C++ Core Guidelines C.131)">World::cells</a></code>). </p><div class="fragment"><div class="line"><span class="keyword">class </span><a class="code hl_class" href="class_world.html">World</a> {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <a class="code hl_class" href="class_world.html">World</a>(...): <a class="code hl_variable" href="class_world.html#ad0716d88091e7641b46ae9d5a7469167">cells</a>{[](...){</div>
<div class="line">    <span class="comment">// construct non-const temporary object (usually named `result`)</span></div>
<div class="line">    std::vector&lt;Cell&gt; result;</div>
<div class="line">    <span class="comment">// populate `result`</span></div>
<div class="line">    result.push_back(...);</div>
<div class="line">    <span class="comment">// (named) return value optimization guarantees that `result` is not copied</span></div>
<div class="line">    <span class="keywordflow">return</span> result;}()</div>
<div class="line">  }{};</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <span class="keyword">const</span> std::vector&lt;Cell&gt; cells;</div>
<div class="line">}</div>
</div><!-- fragment --><p> Both approaches are used throughout MiniMC. IIFE is generally preferred but if it becomes unwieldly and difficult to read, then a static helper function may be warranted.</p>
<h1><a class="anchor" id="developer_guide_input_parsing"></a>
Input Parsing</h1>
<p >MiniMC users create XML input files to specify problem geometry, materials, and other settings. MiniMC uses two XML libraries: <a href="http://xerces.apache.org/xerces-c/">Xerces-C++</a> for XML validation and <a href="https://pugixml.org">pugixml</a> for object construction. Xerces-C++ was selected since it supports <a href="https://www.w3.org/TR/xmlschema-1/">XSD 1.0</a> validation. For object construction, pugixml was selected since it is overwhelmingly easier for developers to use.</p>
<p >MiniMC expects XML input files to follow a particular format. Malformed input files should be reported back to the user. There are two main places where developers can catch malformed input files: <em>XML validation</em> and <em>object creation</em>.</p>
<h2><a class="anchor" id="developer_guide_input_parsing_validation"></a>
XML Validation</h2>
<p >The input file first undergoes XML validation when it is loaded by <a class="el" href="class_x_m_l_document.html" title="Validates document with Xerces-C++. Loads document with pugixml.">XMLDocument</a>. Input files can link to an external schema file in the top-level node: </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">minimc</span></div>
<div class="line">  <span class="keyword">xmlns:xsi</span>=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></div>
<div class="line">  <span class="keyword">xsi:noNamespaceSchemaLocation</span>=<span class="stringliteral">&quot;minimc.xsd&quot;</span>&gt;</div>
<div class="line">  ...</div>
<div class="line">&lt;/<span class="keywordtype">minimc</span>&gt;</div>
</div><!-- fragment --><p >Ideally, developers will catch input file errors during XML validation. This allows errors to be caught before they can propagate downstream. Downstream code can also be guaranteed that the XML input file validates against a schema so certain checks (such as the existence of particular child nodes for a particular parent node) can be skipped entirely.</p>
<h2><a class="anchor" id="developer_guide_input_parsing_object_construction"></a>
Object Construction</h2>
<p >In some cases, the schema is not expressive enough to capture input files which are malformed. For instance, the following input file may pass validation but is still incorrect since the cell <code>badcell</code> refers to <code>nonexistent</code>, a <code>surface</code> which does not exist: </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">surfaces</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">sphere</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;exists&quot;</span> <span class="keyword">x</span>=<span class="stringliteral">&quot;0.&quot;</span> <span class="keyword">y</span>=<span class="stringliteral">&quot;0.&quot;</span> <span class="keyword">z</span>=<span class="stringliteral">&quot;0.&quot;</span> <span class="keyword">r</span>=<span class="stringliteral">&quot;1.&quot;</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">surfaces</span>&gt;</div>
<div class="line">&lt;<span class="keywordtype">cells</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">cell</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;badcell&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">surface</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;nonexistent&quot;</span> <span class="keyword">sense</span>=<span class="stringliteral">&quot;-1&quot;</span>/&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">cell</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">cells</span>&gt;</div>
</div><!-- fragment --><p >In this case, such an error should be caught during the construction of <a class="el" href="class_cell.html" title="A subset of  defined by constructive solid geometry (CSG) surfaces.">Cell</a>.</p>
<h1><a class="anchor" id="developer_guide_variables"></a>
Variables</h1>
<p >Functions may accept variables as parameters and return variables. Some common practices are outlined here.</p>
<h2><a class="anchor" id="developer_guide_variables_passing_parameters"></a>
Passing Parameters</h2>
<p >It is generally recommended to avoid passing by value when one could otherwise pass by const reference. Passing by const reference avoids the overhead of copying a potentially large object: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> func(HugeType x); <span class="comment">// slow!</span></div>
<div class="line"><span class="keywordtype">void</span> func(<span class="keyword">const</span> HugeType&amp; x); <span class="comment">// fast!</span></div>
</div><!-- fragment --><p> The first function creates a copy of <code>x</code> while the second function only copies a pointer to <code>x</code>.</p>
<p >One notable exception is when the type itself can be smaller than the pointer used by references. On one system, a reference might be implemented as an 8-byte pointer whereas a <code>char</code> only occupies 1-byte. In this case, passing the <code>char</code> by const reference may actually be slower than passing by value. A general disucssion on when to pass by reference or pass by value is available <a href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#f15-prefer-simple-and-conventional-ways-of-passing-information">here</a>.</p>
<h2><a class="anchor" id="developer_guide_variables_returning_values"></a>
Returning Values</h2>
<p >A function which intends to return a non-mutable object can either return by value or by const reference: </p><div class="fragment"><div class="line">HugeType func(); <span class="comment">// return by value</span></div>
<div class="line"><span class="keyword">const</span> HugeType&amp; func(); <span class="comment">// return by const reference</span></div>
</div><!-- fragment --><p >In some cases, returning an existing object by value will return a <em>copy </em> of that object. If the object is large, there may be a significant cost incurred in copying such a large object. This can be addressed by <a href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#f44-return-a-t-when-copy-is-undesirable-and-returning-no-object-isnt-needed">returning a const reference</a>. Care must be taken to ensure that the referenced variable does not go out of scope.</p>
<p >In other cases, returning a large object created in the local scope can avoid (<em>elide</em>) copying by using <a href="https://stackoverflow.com/a/2027535/5101335">return value optimization (RVO)</a> when it applies.</p>
<h1><a class="anchor" id="developer_guide_smart_pointers"></a>
Smart Pointers</h1>
<p >This is gonna be a long discussion. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
